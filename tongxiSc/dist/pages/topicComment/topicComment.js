"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
var daaty = require("../../utils/api2.js");
var tipy = require("../../utils/tip.js");
var crettime = require("../../utils/dateutils.js");
var app = getApp();
exports.default = Page({
  data: {
    comments: [],
    allCommentList: [],
    picCommentList: [],
    type: 0,
    valueId: 0,
    showType: 0,
    allCount: 0,
    hasPicCount: 0,
    allPage: 1,
    picPage: 1,
    offset: 0,
    limit: 10
  },
  getCommentCount: function getCommentCount() {
    var that = this;
    daaty.CommentCount(that.data.valueId, that.data.type, null, null, null, successFay);
    function successFay(res, sourceObj) {
      that.setData({
        allCount: res.data.allCount,
        hasPicCount: res.data.hasPicCount
      });
    }
  },
  getCommentList: function getCommentList() {
    var that = this;
    daaty.CommentList(that.data.valueId, that.data.type, that.data.offset, that.data.limit, that.data.showType, null, successFay);
    function successFay(res, sourceObj) {
      that.data.offset = that.data.offset + that.data.limit;
      for (var i = 0; i < res.data.data.length; i++) {
        res.data.data[i].addTime = crettime.getDate(res.data.data[i].addTime);
      }
      if (res.data.data.length == 0) {
        tipy.showToast("只有这么多内容哦");
      }
      if (that.data.showType == 0) {
        that.setData({
          allCommentList: that.data.allCommentList.concat(res.data.data),
          allPage: res.data.currentPage,
          comments: that.data.allCommentList.concat(res.data.data)
        });
      } else {
        that.setData({
          picCommentList: that.data.picCommentList.concat(res.data.data),
          picPage: res.data.currentPage,
          comments: that.data.picCommentList.concat(res.data.data)
        });
      }
    }
  },
  onLoad: function onLoad(options) {
    // 页面初始化 options为页面跳转所带来的参数
    this.setData({
      type: options.type,
      valueId: options.valueId,
      url: app.globalData.imgUrl
    });
    this.getCommentCount();
    this.getCommentList();
  },
  onReady: function onReady() {
    // 页面渲染完成

  },
  onShow: function onShow() {
    // 页面显示

  },
  onHide: function onHide() {
    // 页面隐藏

  },
  onUnload: function onUnload() {
    // 页面关闭

  },
  switchTab: function switchTab() {
    this.setData({
      showType: this.data.showType == 1 ? 0 : 1
    });

    this.getCommentList();
  },
  onReachBottom: function onReachBottom() {
    console.log('onPullDownRefresh');

    // if ( this.data.showType == 0) {

    //   if (this.data.allCount / this.data.size < this.data.allPage) {
    //     return false;
    //   }

    //   this.setData({
    //     'allPage' : this.data.allPage + 1
    //   });
    // } else {
    //   if (this.data.hasPicCount / this.data.size < this.data.picPage) {
    //     return false;
    //   }

    //   this.setData({
    //     'picPage': this.data.picPage + 1
    //   });
    // }


    this.getCommentList();
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvcGljQ29tbWVudC53eHAiXSwibmFtZXMiOlsiZGFhdHkiLCJyZXF1aXJlIiwidGlweSIsImNyZXR0aW1lIiwiYXBwIiwiZ2V0QXBwIiwiZGF0YSIsImNvbW1lbnRzIiwiYWxsQ29tbWVudExpc3QiLCJwaWNDb21tZW50TGlzdCIsInR5cGUiLCJ2YWx1ZUlkIiwic2hvd1R5cGUiLCJhbGxDb3VudCIsImhhc1BpY0NvdW50IiwiYWxsUGFnZSIsInBpY1BhZ2UiLCJvZmZzZXQiLCJsaW1pdCIsImdldENvbW1lbnRDb3VudCIsInRoYXQiLCJDb21tZW50Q291bnQiLCJzdWNjZXNzRmF5IiwicmVzIiwic291cmNlT2JqIiwic2V0RGF0YSIsImdldENvbW1lbnRMaXN0IiwiQ29tbWVudExpc3QiLCJpIiwibGVuZ3RoIiwiYWRkVGltZSIsImdldERhdGUiLCJzaG93VG9hc3QiLCJjb25jYXQiLCJjdXJyZW50UGFnZSIsIm9uTG9hZCIsIm9wdGlvbnMiLCJ1cmwiLCJnbG9iYWxEYXRhIiwiaW1nVXJsIiwib25SZWFkeSIsIm9uU2hvdyIsIm9uSGlkZSIsIm9uVW5sb2FkIiwic3dpdGNoVGFiIiwib25SZWFjaEJvdHRvbSIsImNvbnNvbGUiLCJsb2ciXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBTUEsUUFBU0MsUUFBUSxxQkFBUixDQUFmO0FBQ0EsSUFBTUMsT0FBUUQsUUFBUSxvQkFBUixDQUFkO0FBQ0EsSUFBSUUsV0FBV0YsUUFBUSwwQkFBUixDQUFmO0FBQ0EsSUFBTUcsTUFBTUMsUUFBWjs7QUFNR0MsUUFBTTtBQUNMQyxjQUFVLEVBREw7QUFFTEMsb0JBQWdCLEVBRlg7QUFHTEMsb0JBQWdCLEVBSFg7QUFJTEMsVUFBTSxDQUpEO0FBS0xDLGFBQVMsQ0FMSjtBQU1MQyxjQUFVLENBTkw7QUFPTEMsY0FBVSxDQVBMO0FBUUxDLGlCQUFhLENBUlI7QUFTTEMsYUFBUyxDQVRKO0FBVUxDLGFBQVMsQ0FWSjtBQVdMQyxZQUFPLENBWEY7QUFZTEMsV0FBTztB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QVk7QUFDbkI7O0FBRUQsRztBQUNEQyxVQUFRLGtCQUFZO0FBQ2xCOztBQUVELEc7QUFDREMsVUFBUSxrQkFBWTtBQUNsQjs7QUFFRCxHO0FBQ0RDLFlBQVUsb0JBQVk7QUFDcEI7O0FBRUQsRztBQUNEQyxhQUFXLHFCQUFZO0FBQ3JCLFNBQUtuQixPQUFMLENBQWE7QUFDWGIsZ0JBQVUsS0FBS04sSUFBTCxDQUFVTSxRQUFWLElBQXNCLENBQXRCLEdBQTBCLENBQTFCLEdBQTZCO0FBRDVCLEtBQWI7O0FBSUEsU0FBS2MsY0FBTDtBQUNELEc7QUFDRG1CLGlCQUFlLHlCQUFVO0FBQ3ZCQyxZQUFRQyxHQUFSLENBQVksbUJBQVo7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFJQSxTQUFLckIsY0FBTDtBQUNEIiwiZmlsZSI6InRvcGljQ29tbWVudC53eHAiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBkYWF0eSA9ICByZXF1aXJlKFwiLi4vLi4vdXRpbHMvYXBpMi5qc1wiKVxuY29uc3QgdGlweSA9ICByZXF1aXJlKFwiLi4vLi4vdXRpbHMvdGlwLmpzXCIpXG52YXIgY3JldHRpbWUgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHMvZGF0ZXV0aWxzLmpzXCIpXG5jb25zdCBhcHAgPSBnZXRBcHAoKVxuZXhwb3J0IGRlZmF1bHQge1xuICBjb25maWc6IHtcbiAgICBuYXZpZ2F0aW9uQmFyVGl0bGVUZXh0OiAn5pu05aSa6K+E6K66JyxcbiAgICB1c2luZ0NvbXBvbmVudHM6IHt9XG4gIH0sXG4gICBkYXRhOiB7XG4gICAgY29tbWVudHM6IFtdLFxuICAgIGFsbENvbW1lbnRMaXN0OiBbXSxcbiAgICBwaWNDb21tZW50TGlzdDogW10sXG4gICAgdHlwZTogMCxcbiAgICB2YWx1ZUlkOiAwLFxuICAgIHNob3dUeXBlOiAwLFxuICAgIGFsbENvdW50OiAwLFxuICAgIGhhc1BpY0NvdW50OiAwLFxuICAgIGFsbFBhZ2U6IDEsXG4gICAgcGljUGFnZTogMSxcbiAgICBvZmZzZXQ6MCxcbiAgICBsaW1pdDogMTBcbiAgfSxcbiAgZ2V0Q29tbWVudENvdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgIGRhYXR5LkNvbW1lbnRDb3VudCh0aGF0LmRhdGEudmFsdWVJZCx0aGF0LmRhdGEudHlwZSxudWxsLG51bGwsbnVsbCxzdWNjZXNzRmF5KVxuICAgICAgZnVuY3Rpb24gc3VjY2Vzc0ZheShyZXMsIHNvdXJjZU9iail7XG4gICAgICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICAgIGFsbENvdW50OiByZXMuZGF0YS5hbGxDb3VudCxcbiAgICAgICAgICBoYXNQaWNDb3VudDogcmVzLmRhdGEuaGFzUGljQ291bnRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gIH0sXG4gIGdldENvbW1lbnRMaXN0OiBmdW5jdGlvbigpe1xuICAgIGxldCB0aGF0ID0gdGhpcztcbiAgICAgZGFhdHkuQ29tbWVudExpc3QodGhhdC5kYXRhLnZhbHVlSWQsdGhhdC5kYXRhLnR5cGUsdGhhdC5kYXRhLm9mZnNldCx0aGF0LmRhdGEubGltaXQsdGhhdC5kYXRhLnNob3dUeXBlICxudWxsLHN1Y2Nlc3NGYXkpXG4gICAgICBmdW5jdGlvbiBzdWNjZXNzRmF5KHJlcywgc291cmNlT2JqKXtcbiAgICAgICAgdGhhdC5kYXRhLm9mZnNldCA9IHRoYXQuZGF0YS5vZmZzZXQrdGhhdC5kYXRhLmxpbWl0XG4gICAgICAgIGZvcih2YXIgaT0wO2k8cmVzLmRhdGEuZGF0YS5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIHJlcy5kYXRhLmRhdGFbaV0uYWRkVGltZSA9IGNyZXR0aW1lLmdldERhdGUocmVzLmRhdGEuZGF0YVtpXS5hZGRUaW1lKVxuICAgICAgICAgIH1cbiAgICAgICAgaWYocmVzLmRhdGEuZGF0YS5sZW5ndGggPT0gMCl7XG4gICAgICAgICAgICB0aXB5LnNob3dUb2FzdChcIuWPquaciei/meS5iOWkmuWGheWuueWTplwiKVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGF0LmRhdGEuc2hvd1R5cGUgPT0gMCkge1xuICAgICAgICAgIHRoYXQuc2V0RGF0YSh7XG4gICAgICAgICAgICBhbGxDb21tZW50TGlzdDogdGhhdC5kYXRhLmFsbENvbW1lbnRMaXN0LmNvbmNhdChyZXMuZGF0YS5kYXRhKSxcbiAgICAgICAgICAgIGFsbFBhZ2U6IHJlcy5kYXRhLmN1cnJlbnRQYWdlLFxuICAgICAgICAgICAgY29tbWVudHM6IHRoYXQuZGF0YS5hbGxDb21tZW50TGlzdC5jb25jYXQocmVzLmRhdGEuZGF0YSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICAgICAgcGljQ29tbWVudExpc3Q6IHRoYXQuZGF0YS5waWNDb21tZW50TGlzdC5jb25jYXQocmVzLmRhdGEuZGF0YSksXG4gICAgICAgICAgICBwaWNQYWdlOiByZXMuZGF0YS5jdXJyZW50UGFnZSxcbiAgICAgICAgICAgIGNvbW1lbnRzOiB0aGF0LmRhdGEucGljQ29tbWVudExpc3QuY29uY2F0KHJlcy5kYXRhLmRhdGEpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgfSxcbiAgb25Mb2FkOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIC8vIOmhtemdouWIneWni+WMliBvcHRpb25z5Li66aG16Z2i6Lez6L2s5omA5bim5p2l55qE5Y+C5pWwXG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHR5cGU6IG9wdGlvbnMudHlwZSxcbiAgICAgIHZhbHVlSWQ6IG9wdGlvbnMudmFsdWVJZCxcbiAgICAgIHVybDogYXBwLmdsb2JhbERhdGEuaW1nVXJsXG4gICAgfSk7XG4gICAgdGhpcy5nZXRDb21tZW50Q291bnQoKTtcbiAgICB0aGlzLmdldENvbW1lbnRMaXN0KCk7XG4gIH0sXG4gIG9uUmVhZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyDpobXpnaLmuLLmn5PlrozmiJBcblxuICB9LFxuICBvblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyDpobXpnaLmmL7npLpcblxuICB9LFxuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyDpobXpnaLpmpDol49cblxuICB9LFxuICBvblVubG9hZDogZnVuY3Rpb24gKCkge1xuICAgIC8vIOmhtemdouWFs+mXrVxuXG4gIH0sXG4gIHN3aXRjaFRhYjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBzaG93VHlwZTogdGhpcy5kYXRhLnNob3dUeXBlID09IDEgPyAwIDoxXG4gICAgfSk7XG5cbiAgICB0aGlzLmdldENvbW1lbnRMaXN0KCk7XG4gIH0sXG4gIG9uUmVhY2hCb3R0b206IGZ1bmN0aW9uKCl7XG4gICAgY29uc29sZS5sb2coJ29uUHVsbERvd25SZWZyZXNoJyk7XG5cbiAgICAvLyBpZiAoIHRoaXMuZGF0YS5zaG93VHlwZSA9PSAwKSB7XG5cbiAgICAvLyAgIGlmICh0aGlzLmRhdGEuYWxsQ291bnQgLyB0aGlzLmRhdGEuc2l6ZSA8IHRoaXMuZGF0YS5hbGxQYWdlKSB7XG4gICAgLy8gICAgIHJldHVybiBmYWxzZTtcbiAgICAvLyAgIH1cblxuICAgIC8vICAgdGhpcy5zZXREYXRhKHtcbiAgICAvLyAgICAgJ2FsbFBhZ2UnIDogdGhpcy5kYXRhLmFsbFBhZ2UgKyAxXG4gICAgLy8gICB9KTtcbiAgICAvLyB9IGVsc2Uge1xuICAgIC8vICAgaWYgKHRoaXMuZGF0YS5oYXNQaWNDb3VudCAvIHRoaXMuZGF0YS5zaXplIDwgdGhpcy5kYXRhLnBpY1BhZ2UpIHtcbiAgICAvLyAgICAgcmV0dXJuIGZhbHNlO1xuICAgIC8vICAgfVxuXG4gICAgLy8gICB0aGlzLnNldERhdGEoe1xuICAgIC8vICAgICAncGljUGFnZSc6IHRoaXMuZGF0YS5waWNQYWdlICsgMVxuICAgIC8vICAgfSk7XG4gICAgLy8gfVxuXG5cblxuICAgIHRoaXMuZ2V0Q29tbWVudExpc3QoKTtcbiAgfVxufSJdfQ==