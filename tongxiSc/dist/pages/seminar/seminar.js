"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
var WxParse = require("../../utils/util.js");
var daaty = require("../../utils/api2.js");
var cache = require("../../utils/cache.js");
var crettime = require("../../utils/dateutils.js");
var app = getApp();
var loginFlag = cache.getSync('loginFlag');
exports.default = Page({
  data: {
    id: 0,
    topic: {},
    topicList: [],
    commentCount: 0,
    commentList: [],
    offset: 0,
    limit: 10
  },
  onLoad: function onLoad(options) {
    // 页面初始化 options为页面跳转所带来的参数
    var that = this;
    that.setData({
      id: options.id,
      url: app.globalData.imgUrl
    });
    daaty.TopicDetail(that.data.id, null, successFay);
    function successFay(res, sourceObj) {
      that.setData({
        topic: res.data
      });
      WxParse.wxParse('topicDetail', 'html', res.data.content, that);
    }

    daaty.TopicRelated(that.data.id, null, successFay);
    function successFay(res, sourceObj) {
      that.setData({
        topicList: res.data
      });
    }
  },
  getCommentList: function getCommentList() {
    var that = this;
    var newarr = [];
    daaty.CommentList(that.data.id, 1, that.data.offset, that.data.limit, 0, null, successFay);
    function successFay(res, sourceObj) {
      for (var i = 0; i < res.data.data.length; i++) {
        res.data.data[i].addTime = crettime.getDate(res.data.data[i].addTime);
        newarr.push(res.data.data[i]);
        if (i == 3) {
          break;
        }
      }
      that.setData({
        commentList: newarr,
        commentCount: res.data.count
      });
    }
  },
  postComment: function postComment() {
    if (!loginFlag) {
      wx.navigateTo({ url: "/pages/auth/login/login" });
    } else {
      wx.navigateTo({
        url: '../topicCommentPost/topicCommentPost?valueId=' + this.data.id + '&type=1'
      });
    }
  },

  onReady: function onReady() {},
  onShow: function onShow() {
    // 页面显示
    this.getCommentList();
  },
  onHide: function onHide() {
    // 页面隐藏

  },
  onUnload: function onUnload() {
    // 页面关闭

  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbWluYXIud3hwIl0sIm5hbWVzIjpbIld4UGFyc2UiLCJyZXF1aXJlIiwiZGFhdHkiLCJjYWNoZSIsImNyZXR0aW1lIiwiYXBwIiwiZ2V0QXBwIiwibG9naW5GbGFnIiwiZ2V0U3luYyIsImRhdGEiLCJpZCIsInRvcGljIiwidG9waWNMaXN0IiwiY29tbWVudENvdW50IiwiY29tbWVudExpc3QiLCJvZmZzZXQiLCJsaW1pdCIsIm9uTG9hZCIsIm9wdGlvbnMiLCJ0aGF0Iiwic2V0RGF0YSIsInVybCIsImdsb2JhbERhdGEiLCJpbWdVcmwiLCJUb3BpY0RldGFpbCIsInN1Y2Nlc3NGYXkiLCJyZXMiLCJzb3VyY2VPYmoiLCJ3eFBhcnNlIiwiY29udGVudCIsIlRvcGljUmVsYXRlZCIsImdldENvbW1lbnRMaXN0IiwibmV3YXJyIiwiQ29tbWVudExpc3QiLCJpIiwibGVuZ3RoIiwiYWRkVGltZSIsImdldERhdGUiLCJwdXNoIiwiY291bnQiLCJwb3N0Q29tbWVudCIsInd4IiwibmF2aWdhdGVUbyIsIm9uUmVhZHkiLCJvblNob3ciLCJvbkhpZGUiLCJvblVubG9hZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxJQUFJQSxVQUFVQyxRQUFRLHFCQUFSLENBQWQ7QUFDQSxJQUFNQyxRQUFTRCxRQUFRLHFCQUFSLENBQWY7QUFDQSxJQUFJRSxRQUFTRixRQUFRLHNCQUFSLENBQWI7QUFDQSxJQUFJRyxXQUFXSCxRQUFRLDBCQUFSLENBQWY7QUFDQSxJQUFNSSxNQUFNQyxRQUFaO0FBQ0EsSUFBSUMsWUFBWUosTUFBTUssT0FBTixDQUFjLFdBQWQsQ0FBaEI7O0FBTUVDLFFBQU07QUFDSkMsUUFBSSxDQURBO0FBRUpDLFdBQU8sRUFGSDtBQUdKQyxlQUFXLEVBSFA7QUFJSkMsa0JBQWMsQ0FKVjtBQUtKQyxpQkFBYSxFQUxUO0FBTUpDLFlBQU8sQ0FOSDtBQU9KQyxXQUFNO0FBUEYsRztBQVNOQyxVQUFRLGdCQUFVQyxPQUFWLEVBQW1CO0FBQ3pCO0FBQ0EsUUFBSUMsT0FBTyxJQUFYO0FBQ0FBLFNBQUtDLE9BQUwsQ0FBYTtBQUNYVixVQUFJUSxRQUFRUixFQUREO0FBRVhXLFdBQUtoQixJQUFJaUIsVUFBSixDQUFlQztBQUZULEtBQWI7QUFJRnJCLFVBQU1zQixXQUFOLENBQWtCTCxLQUFLVixJQUFMLENBQVVDLEVBQTVCLEVBQStCLElBQS9CLEVBQW9DZSxVQUFwQztBQUNFLGFBQVNBLFVBQVQsQ0FBb0JDLEdBQXBCLEVBQXlCQyxTQUF6QixFQUFtQztBQUM3QlIsV0FBS0MsT0FBTCxDQUFhO0FBQ1hULGVBQU9lLElBQUlqQjtBQURBLE9BQWI7QUFHQVQsY0FBUTRCLE9BQVIsQ0FBZ0IsYUFBaEIsRUFBK0IsTUFBL0IsRUFBdUNGLElBQUlqQixJQUFKLENBQVNvQixPQUFoRCxFQUF5RFYsSUFBekQ7QUFDTDs7QUFFSGpCLFVBQU00QixZQUFOLENBQW1CWCxLQUFLVixJQUFMLENBQVVDLEVBQTdCLEVBQWdDLElBQWhDLEVBQXFDZSxVQUFyQztBQUNJLGFBQVNBLFVBQVQsQ0FBb0JDLEdBQXBCLEVBQXlCQyxTQUF6QixFQUFtQztBQUMvQlIsV0FBS0MsT0FBTCxDQUFhO0FBQ1hSLG1CQUFXYyxJQUFJakI7QUFESixPQUFiO0FBR0g7QUFDRixHO0FBQ0hzQixnQiw0QkFBaUI7QUFDZixRQUFJWixPQUFPLElBQVg7QUFDQSxRQUFJYSxTQUFTLEVBQWI7QUFDQTlCLFVBQU0rQixXQUFOLENBQWtCZCxLQUFLVixJQUFMLENBQVVDLEVBQTVCLEVBQStCLENBQS9CLEVBQWlDUyxLQUFLVixJQUFMLENBQVVNLE1BQTNDLEVBQWtESSxLQUFLVixJQUFMLENBQVVPLEtBQTVELEVBQWtFLENBQWxFLEVBQW9FLElBQXBFLEVBQXlFUyxVQUF6RTtBQUNFLGFBQVNBLFVBQVQsQ0FBb0JDLEdBQXBCLEVBQXlCQyxTQUF6QixFQUFtQztBQUMvQixXQUFJLElBQUlPLElBQUUsQ0FBVixFQUFZQSxJQUFFUixJQUFJakIsSUFBSixDQUFTQSxJQUFULENBQWMwQixNQUE1QixFQUFtQ0QsR0FBbkMsRUFBdUM7QUFDckNSLFlBQUlqQixJQUFKLENBQVNBLElBQVQsQ0FBY3lCLENBQWQsRUFBaUJFLE9BQWpCLEdBQTJCaEMsU0FBU2lDLE9BQVQsQ0FBaUJYLElBQUlqQixJQUFKLENBQVNBLElBQVQsQ0FBY3lCLENBQWQsRUFBaUJFLE9BQWxDLENBQTNCO0FBQ0FKLGVBQU9NLElBQVAsQ0FBWVosSUFBSWpCLElBQUosQ0FBU0EsSUFBVCxDQUFjeUIsQ0FBZCxDQUFaO0FBQ0EsWUFBR0EsS0FBSyxDQUFSLEVBQVU7QUFDUjtBQUNEO0FBQ0Y7QUFDQ2YsV0FBS0MsT0FBTCxDQUFhO0FBQ1hOLHFCQUFha0IsTUFERjtBQUVYbkIsc0JBQWNhLElBQUlqQixJQUFKLENBQVM4QjtBQUZaLE9BQWI7QUFJTDtBQUNKLEc7QUFDREMsYSx5QkFBYztBQUNaLFFBQUksQ0FBQ2pDLFNBQUwsRUFBZ0I7QUFDZGtDLFNBQUdDLFVBQUgsQ0FBYyxFQUFFckIsS0FBSyx5QkFBUCxFQUFkO0FBQ0QsS0FGRCxNQUdLO0FBQ0RvQixTQUFHQyxVQUFILENBQWM7QUFDZHJCLGFBQUssa0RBQWtELEtBQUtaLElBQUwsQ0FBVUMsRUFBNUQsR0FBaUU7QUFEeEQsT0FBZDtBQUdIO0FBQ0YsRzs7QUFDRGlDLFdBQVMsbUJBQVksQ0FFcEIsQztBQUNEQyxVQUFRLGtCQUFZO0FBQ2xCO0FBQ0EsU0FBS2IsY0FBTDtBQUNELEc7QUFDRGMsVUFBUSxrQkFBWTtBQUNsQjs7QUFFRCxHO0FBQ0RDLFlBQVUsb0JBQVk7QUFDcEI7O0FBRUQiLCJmaWxlIjoic2VtaW5hci53eHAiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgV3hQYXJzZSA9IHJlcXVpcmUoXCIuLi8uLi91dGlscy91dGlsLmpzXCIpXG5jb25zdCBkYWF0eSA9ICByZXF1aXJlKFwiLi4vLi4vdXRpbHMvYXBpMi5qc1wiKVxudmFyIGNhY2hlID0gIHJlcXVpcmUoXCIuLi8uLi91dGlscy9jYWNoZS5qc1wiKVxudmFyIGNyZXR0aW1lID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzL2RhdGV1dGlscy5qc1wiKVxuY29uc3QgYXBwID0gZ2V0QXBwKClcbnZhciBsb2dpbkZsYWcgPSBjYWNoZS5nZXRTeW5jKCdsb2dpbkZsYWcnKTtcbmV4cG9ydCBkZWZhdWx0IHtcbiAgY29uZmlnOiB7XG4gICAgbmF2aWdhdGlvbkJhclRpdGxlVGV4dDogJ+S4k+mimOivpuaDhScsXG4gICAgdXNpbmdDb21wb25lbnRzOiB7fVxuICB9LFxuICBkYXRhOiB7XG4gICAgaWQ6IDAsXG4gICAgdG9waWM6IHt9LFxuICAgIHRvcGljTGlzdDogW10sXG4gICAgY29tbWVudENvdW50OiAwLFxuICAgIGNvbW1lbnRMaXN0OiBbXSxcbiAgICBvZmZzZXQ6MCxcbiAgICBsaW1pdDoxMFxuICB9LFxuICBvbkxvYWQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgLy8g6aG16Z2i5Yid5aeL5YyWIG9wdGlvbnPkuLrpobXpnaLot7PovazmiYDluKbmnaXnmoTlj4LmlbBcbiAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgdGhhdC5zZXREYXRhKHtcbiAgICAgIGlkOiBvcHRpb25zLmlkLFxuICAgICAgdXJsOiBhcHAuZ2xvYmFsRGF0YS5pbWdVcmxcbiAgICB9KTtcbiAgZGFhdHkuVG9waWNEZXRhaWwodGhhdC5kYXRhLmlkLG51bGwsc3VjY2Vzc0ZheSlcbiAgICBmdW5jdGlvbiBzdWNjZXNzRmF5KHJlcywgc291cmNlT2JqKXtcbiAgICAgICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICAgICAgdG9waWM6IHJlcy5kYXRhLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFd4UGFyc2Uud3hQYXJzZSgndG9waWNEZXRhaWwnLCAnaHRtbCcsIHJlcy5kYXRhLmNvbnRlbnQsIHRoYXQpO1xuICAgIH1cbiAgICAgIFxuICBkYWF0eS5Ub3BpY1JlbGF0ZWQodGhhdC5kYXRhLmlkLG51bGwsc3VjY2Vzc0ZheSlcbiAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NGYXkocmVzLCBzb3VyY2VPYmope1xuICAgICAgICAgIHRoYXQuc2V0RGF0YSh7XG4gICAgICAgICAgICB0b3BpY0xpc3Q6IHJlcy5kYXRhXG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgZ2V0Q29tbWVudExpc3QoKSB7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgIGxldCBuZXdhcnIgPSBbXTtcbiAgICBkYWF0eS5Db21tZW50TGlzdCh0aGF0LmRhdGEuaWQsMSx0aGF0LmRhdGEub2Zmc2V0LHRoYXQuZGF0YS5saW1pdCwwLG51bGwsc3VjY2Vzc0ZheSlcbiAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NGYXkocmVzLCBzb3VyY2VPYmope1xuICAgICAgICAgIGZvcih2YXIgaT0wO2k8cmVzLmRhdGEuZGF0YS5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIHJlcy5kYXRhLmRhdGFbaV0uYWRkVGltZSA9IGNyZXR0aW1lLmdldERhdGUocmVzLmRhdGEuZGF0YVtpXS5hZGRUaW1lKVxuICAgICAgICAgICAgbmV3YXJyLnB1c2gocmVzLmRhdGEuZGF0YVtpXSlcbiAgICAgICAgICAgIGlmKGkgPT0gMyl7XG4gICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgICAgICAgY29tbWVudExpc3Q6IG5ld2FycixcbiAgICAgICAgICAgICAgY29tbWVudENvdW50OiByZXMuZGF0YS5jb3VudFxuICAgICAgICAgICAgfSk7XG4gICAgICB9XG4gIH0sXG4gIHBvc3RDb21tZW50KCkge1xuICAgIGlmICghbG9naW5GbGFnKSB7XG4gICAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiBcIi9wYWdlcy9hdXRoL2xvZ2luL2xvZ2luXCIgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgdXJsOiAnLi4vdG9waWNDb21tZW50UG9zdC90b3BpY0NvbW1lbnRQb3N0P3ZhbHVlSWQ9JyArIHRoaXMuZGF0YS5pZCArICcmdHlwZT0xJyxcbiAgICAgICAgIH0pXG4gICAgfVxuICB9LFxuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG5cbiAgfSxcbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgLy8g6aG16Z2i5pi+56S6XG4gICAgdGhpcy5nZXRDb21tZW50TGlzdCgpO1xuICB9LFxuICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyDpobXpnaLpmpDol49cblxuICB9LFxuICBvblVubG9hZDogZnVuY3Rpb24gKCkge1xuICAgIC8vIOmhtemdouWFs+mXrVxuXG4gIH1cbn0iXX0=