"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
var daaty = require("../../utils/api2.js");
var utily = require("../../utils/util.js");
var app = getApp();
exports.default = Page({
  data: {
    comments: [],
    allCommentList: [],
    picCommentList: [],
    type: 0,
    valueId: 0,
    showType: 0,
    allCount: 0,
    hasPicCount: 0,
    offset: 0, //每次请求返回的位置 主要是给后台判断用
    limit: 10 //每次请求的数量
  },
  getCommentCount: function getCommentCount() {
    var that = this;
    daaty.CommentCount(that.data.valueId, that.data.type, null, null, null, null, successFay);
    function successFay(res, sourceObj) {
      that.setData({
        allCount: res.data.allCount,
        hasPicCount: res.data.hasPicCount
      });
    }
  },
  getCommentList: function getCommentList() {
    var that = this;

    daaty.CommentList(that.data.valueId, that.data.type, that.data.offset, that.data.limit, that.data.showType, null, successFay);
    function successFay(res, sourceObj) {
      for (var i = 0; i < res.data.data.length; i++) {
        res.data.data[i].addTime = utily.getDate(res.data.data[i].addTime);
      }
      that.setData({ offset: that.data.offset + that.data.limit });
      if (that.data.showType == 0) {
        that.setData({
          allCommentList: that.data.allCommentList.concat(res.data.data),
          comments: that.data.allCommentList.concat(res.data.data)
        });
      } else {
        that.setData({
          picCommentList: that.data.picCommentList.concat(res.data.data),
          comments: that.data.picCommentList.concat(res.data.data)
        });
      }
    }
  },
  onLoad: function onLoad(options) {
    // 页面初始化 options为页面跳转所带来的参数
    this.setData({
      type: options.type,
      valueId: options.valueId,
      url: app.globalData.imgUrl
    });
    this.getCommentCount();
    this.getCommentList();
  },
  onReady: function onReady() {
    // 页面渲染完成

  },
  onShow: function onShow() {
    // 页面显示

  },
  onHide: function onHide() {
    // 页面隐藏

  },
  onUnload: function onUnload() {
    // 页面关闭

  },
  switchTab: function switchTab() {
    var that = this;
    if (that.data.showType == 0) {
      that.setData({
        allCommentList: [],
        offset: 0,
        comments: [],
        showType: 1
      });
      wx.pageScrollTo({
        scrollTop: 0
      });
    } else {
      that.setData({
        picCommentList: [],
        offset: 0,
        comments: [],
        showType: 0
      });
      wx.pageScrollTo({
        scrollTop: 0
      });
    }
    this.getCommentList();
  },
  onReachBottom: function onReachBottom() {
    // console.log('onPullDownRefresh');
    if (this.data.showType == 0) {

      if (this.data.allCount / this.data.size < this.data.allPage) {
        return false;
      }

      this.setData({
        'allPage': this.data.allPage + 1
      });
    } else {
      if (this.data.hasPicCount / this.data.size < this.data.picPage) {
        return false;
      }

      this.setData({
        'picPage': this.data.picPage + 1
      });
    }

    this.getCommentList();
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1lbnQud3hwIl0sIm5hbWVzIjpbImRhYXR5IiwicmVxdWlyZSIsInV0aWx5IiwiYXBwIiwiZ2V0QXBwIiwiZGF0YSIsImNvbW1lbnRzIiwiYWxsQ29tbWVudExpc3QiLCJwaWNDb21tZW50TGlzdCIsInR5cGUiLCJ2YWx1ZUlkIiwic2hvd1R5cGUiLCJhbGxDb3VudCIsImhhc1BpY0NvdW50Iiwib2Zmc2V0IiwibGltaXQiLCJnZXRDb21tZW50Q291bnQiLCJ0aGF0IiwiQ29tbWVudENvdW50Iiwic3VjY2Vzc0ZheSIsInJlcyIsInNvdXJjZU9iaiIsInNldERhdGEiLCJnZXRDb21tZW50TGlzdCIsIkNvbW1lbnRMaXN0IiwiaSIsImxlbmd0aCIsImFkZFRpbWUiLCJnZXREYXRlIiwiY29uY2F0Iiwib25Mb2FkIiwib3B0aW9ucyIsInVybCIsImdsb2JhbERhdGEiLCJpbWdVcmwiLCJvblJlYWR5Iiwib25TaG93Iiwib25IaWRlIiwib25VbmxvYWQiLCJzd2l0Y2hUYWIiLCJ3eCIsInBhZ2VTY3JvbGxUbyIsInNjcm9sbFRvcCIsIm9uUmVhY2hCb3R0b20iLCJzaXplIiwiYWxsUGFnZSIsInBpY1BhZ2UiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBTUEsUUFBU0MsUUFBUSxxQkFBUixDQUFmO0FBQ0EsSUFBTUMsUUFBU0QsUUFBUSxxQkFBUixDQUFmO0FBQ0EsSUFBSUUsTUFBTUMsUUFBVjs7QUFNSUMsUUFBTTtBQUNOQyxjQUFVLEVBREo7QUFFTkMsb0JBQWdCLEVBRlY7QUFHTkMsb0JBQWdCLEVBSFY7QUFJTkMsVUFBTSxDQUpBO0FBS05DLGFBQVMsQ0FMSDtBQU1OQyxjQUFVLENBTko7QUFPTkMsY0FBVSxDQVBKO0FBUU5DLGlCQUFhLENBUlA7QUFTTkMsWUFBTyxDQVRELEVBU0s7QUFDWEMsV0FBTSxFQVZBLENBVUs7QUFWTCxHO0FBWVJDLG1CQUFpQiwyQkFBWTtBQUMzQixRQUFJQyxPQUFPLElBQVg7QUFDQ2pCLFVBQU1rQixZQUFOLENB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QURMO0FBRVhPLGdCQUFPLENBRkk7QUFHWFIsa0JBQVUsRUFIQztBQUlYSyxrQkFBVTtBQUpDLE9BQWI7QUFNQTZCLFNBQUdDLFlBQUgsQ0FBZ0I7QUFDWkMsbUJBQVc7QUFEQyxPQUFoQjtBQUdELEtBVkQsTUFVTztBQUNMekIsV0FBS0ssT0FBTCxDQUFhO0FBQ1hkLHdCQUFnQixFQURMO0FBRVhNLGdCQUFPLENBRkk7QUFHWFIsa0JBQVUsRUFIQztBQUlYSyxrQkFBVTtBQUpDLE9BQWI7QUFNQTZCLFNBQUdDLFlBQUgsQ0FBZ0I7QUFDaEJDLG1CQUFXO0FBREssT0FBaEI7QUFHRDtBQUNELFNBQUtuQixjQUFMO0FBQ0QsRztBQUNEb0IsaUJBQWUseUJBQVU7QUFDdkI7QUFDQSxRQUFLLEtBQUt0QyxJQUFMLENBQVVNLFFBQVYsSUFBc0IsQ0FBM0IsRUFBOEI7O0FBRTVCLFVBQUksS0FBS04sSUFBTCxDQUFVTyxRQUFWLEdBQXFCLEtBQUtQLElBQUwsQ0FBVXVDLElBQS9CLEdBQXNDLEtBQUt2QyxJQUFMLENBQVV3QyxPQUFwRCxFQUE2RDtBQUMzRCxlQUFPLEtBQVA7QUFDRDs7QUFFRCxXQUFLdkIsT0FBTCxDQUFhO0FBQ1gsbUJBQVksS0FBS2pCLElBQUwsQ0FBVXdDLE9BQVYsR0FBb0I7QUFEckIsT0FBYjtBQUdELEtBVEQsTUFTTztBQUNMLFVBQUksS0FBS3hDLElBQUwsQ0FBVVEsV0FBVixHQUF3QixLQUFLUixJQUFMLENBQVV1QyxJQUFsQyxHQUF5QyxLQUFLdkMsSUFBTCxDQUFVeUMsT0FBdkQsRUFBZ0U7QUFDOUQsZUFBTyxLQUFQO0FBQ0Q7O0FBRUQsV0FBS3hCLE9BQUwsQ0FBYTtBQUNYLG1CQUFXLEtBQUtqQixJQUFMLENBQVV5QyxPQUFWLEdBQW9CO0FBRHBCLE9BQWI7QUFHRDs7QUFFRCxTQUFLdkIsY0FBTDtBQUNEIiwiZmlsZSI6ImNvbW1lbnQud3hwIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZGFhdHkgPSAgcmVxdWlyZShcIi4uLy4uL3V0aWxzL2FwaTIuanNcIilcbmNvbnN0IHV0aWx5ID0gIHJlcXVpcmUoXCIuLi8uLi91dGlscy91dGlsLmpzXCIpXG52YXIgYXBwID0gZ2V0QXBwKCk7XG5leHBvcnQgZGVmYXVsdCB7XG4gIGNvbmZpZzoge1xuICAgIG5hdmlnYXRpb25CYXJUaXRsZVRleHQ6ICfor4Torrror6bmg4UnLFxuICAgIHVzaW5nQ29tcG9uZW50czoge31cbiAgfSxcbiAgICBkYXRhOiB7XG4gICAgY29tbWVudHM6IFtdLFxuICAgIGFsbENvbW1lbnRMaXN0OiBbXSxcbiAgICBwaWNDb21tZW50TGlzdDogW10sXG4gICAgdHlwZTogMCxcbiAgICB2YWx1ZUlkOiAwLFxuICAgIHNob3dUeXBlOiAwLFxuICAgIGFsbENvdW50OiAwLFxuICAgIGhhc1BpY0NvdW50OiAwLFxuICAgIG9mZnNldDowLCAgLy/mr4/mrKHor7fmsYLov5Tlm57nmoTkvY3nva4g5Li76KaB5piv57uZ5ZCO5Y+w5Yik5pat55SoXG4gICAgbGltaXQ6MTAgICAvL+avj+asoeivt+axgueahOaVsOmHj1xuICB9LFxuICBnZXRDb21tZW50Q291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgdGhhdCA9IHRoaXM7XG4gICAgIGRhYXR5LkNvbW1lbnRDb3VudCggdGhhdC5kYXRhLnZhbHVlSWQsdGhhdC5kYXRhLnR5cGUsbnVsbCxudWxsLG51bGwsbnVsbCxzdWNjZXNzRmF5KVxuICAgICAgZnVuY3Rpb24gc3VjY2Vzc0ZheShyZXMsIHNvdXJjZU9iail7XG4gICAgICAgICAgIHRoYXQuc2V0RGF0YSh7XG4gICAgICAgICAgICAgIGFsbENvdW50OiByZXMuZGF0YS5hbGxDb3VudCxcbiAgICAgICAgICAgICAgaGFzUGljQ291bnQ6IHJlcy5kYXRhLmhhc1BpY0NvdW50XG4gICAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgfSxcbiAgZ2V0Q29tbWVudExpc3Q6IGZ1bmN0aW9uKCl7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgICBcbiAgICBkYWF0eS5Db21tZW50TGlzdCggdGhhdC5kYXRhLnZhbHVlSWQsdGhhdC5kYXRhLnR5cGUsdGhhdC5kYXRhLm9mZnNldCx0aGF0LmRhdGEubGltaXQsdGhhdC5kYXRhLnNob3dUeXBlICxudWxsLHN1Y2Nlc3NGYXkpXG4gICAgICBmdW5jdGlvbiBzdWNjZXNzRmF5KHJlcywgc291cmNlT2JqKXtcbiAgICAgICAgZm9yKHZhciBpPTA7aTxyZXMuZGF0YS5kYXRhLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgIHJlcy5kYXRhLmRhdGFbaV0uYWRkVGltZSA9IHV0aWx5LmdldERhdGUocmVzLmRhdGEuZGF0YVtpXS5hZGRUaW1lKVxuICAgICAgICB9XG4gICAgICAgIHRoYXQuc2V0RGF0YSh7b2Zmc2V0OnRoYXQuZGF0YS5vZmZzZXQrdGhhdC5kYXRhLmxpbWl0fSlcbiAgICAgICAgaWYgKHRoYXQuZGF0YS5zaG93VHlwZSA9PSAwKSB7XG4gICAgICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgICAgIGFsbENvbW1lbnRMaXN0OiB0aGF0LmRhdGEuYWxsQ29tbWVudExpc3QuY29uY2F0KHJlcy5kYXRhLmRhdGEpLFxuICAgICAgICAgICAgY29tbWVudHM6IHRoYXQuZGF0YS5hbGxDb21tZW50TGlzdC5jb25jYXQocmVzLmRhdGEuZGF0YSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICAgICAgcGljQ29tbWVudExpc3Q6IHRoYXQuZGF0YS5waWNDb21tZW50TGlzdC5jb25jYXQocmVzLmRhdGEuZGF0YSksXG4gICAgICAgICAgICBjb21tZW50czogdGhhdC5kYXRhLnBpY0NvbW1lbnRMaXN0LmNvbmNhdChyZXMuZGF0YS5kYXRhKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gIH0sXG4gIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAvLyDpobXpnaLliJ3lp4vljJYgb3B0aW9uc+S4uumhtemdoui3s+i9rOaJgOW4puadpeeahOWPguaVsFxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICB0eXBlOiBvcHRpb25zLnR5cGUsXG4gICAgICB2YWx1ZUlkOiBvcHRpb25zLnZhbHVlSWQsXG4gICAgICB1cmw6IGFwcC5nbG9iYWxEYXRhLmltZ1VybFxuICAgIH0pO1xuICAgIHRoaXMuZ2V0Q29tbWVudENvdW50KCk7XG4gICAgdGhpcy5nZXRDb21tZW50TGlzdCgpO1xuICB9LFxuICBvblJlYWR5OiBmdW5jdGlvbiAoKSB7XG4gICAgLy8g6aG16Z2i5riy5p+T5a6M5oiQXG5cbiAgfSxcbiAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgLy8g6aG16Z2i5pi+56S6XG5cbiAgfSxcbiAgb25IaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8g6aG16Z2i6ZqQ6JePXG5cbiAgfSxcbiAgb25VbmxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyDpobXpnaLlhbPpl61cblxuICB9LFxuICBzd2l0Y2hUYWI6IGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgdGhhdCA9IHRoaXM7XG4gICAgaWYgKHRoYXQuZGF0YS5zaG93VHlwZSA9PSAwKSB7XG4gICAgICB0aGF0LnNldERhdGEoe1xuICAgICAgICBhbGxDb21tZW50TGlzdDogW10sXG4gICAgICAgIG9mZnNldDowLFxuICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIHNob3dUeXBlOiAxXG4gICAgICB9KTtcbiAgICAgIHd4LnBhZ2VTY3JvbGxUbyh7XG4gICAgICAgICAgc2Nyb2xsVG9wOiAwXG4gICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhhdC5zZXREYXRhKHtcbiAgICAgICAgcGljQ29tbWVudExpc3Q6IFtdLFxuICAgICAgICBvZmZzZXQ6MCxcbiAgICAgICAgY29tbWVudHM6IFtdLFxuICAgICAgICBzaG93VHlwZTogMFxuICAgICAgfSk7XG4gICAgICB3eC5wYWdlU2Nyb2xsVG8oe1xuICAgICAgc2Nyb2xsVG9wOiAwXG4gICAgICAgIH0pXG4gICAgfVxuICAgIHRoaXMuZ2V0Q29tbWVudExpc3QoKTtcbiAgfSxcbiAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24oKXtcbiAgICAvLyBjb25zb2xlLmxvZygnb25QdWxsRG93blJlZnJlc2gnKTtcbiAgICBpZiAoIHRoaXMuZGF0YS5zaG93VHlwZSA9PSAwKSB7XG5cbiAgICAgIGlmICh0aGlzLmRhdGEuYWxsQ291bnQgLyB0aGlzLmRhdGEuc2l6ZSA8IHRoaXMuZGF0YS5hbGxQYWdlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgJ2FsbFBhZ2UnIDogdGhpcy5kYXRhLmFsbFBhZ2UgKyAxXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuZGF0YS5oYXNQaWNDb3VudCAvIHRoaXMuZGF0YS5zaXplIDwgdGhpcy5kYXRhLnBpY1BhZ2UpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAncGljUGFnZSc6IHRoaXMuZGF0YS5waWNQYWdlICsgMVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5nZXRDb21tZW50TGlzdCgpO1xuICB9XG59Il19